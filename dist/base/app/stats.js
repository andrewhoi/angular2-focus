"use strict";var __decorate=this&&this.__decorate||function(e,t,r,a){var i,s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,a);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(3>s?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},__metadata=this&&this.__metadata||function(e,t){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(e,t):void 0},core_1=require("angular2/core"),focus_phase_component_1=require("./components/focus-phase.component"),data_service_1=require("./services/data.service"),interfaces_1=require("./interfaces/interfaces"),auth_service_1=require("./services/auth.service"),Stats=function(){function e(e,t){var r=this;this._authService=e,this._dataService=t,this.graphCreated=!1,this.totalFocusedTime=0,this.focusSubscription=this._authService.authUser$.subscribe(function(e){return r.user=e}),this.userSubscription=this._dataService.focusPhases$.subscribe(function(e){r.phases=e,r._setUpHistory()})}return e.prototype.ngOnInit=function(){this._authService.loadAuthUser(),this._dataService.loadFocusPhases()},e.prototype.ngOnDestroy=function(){this.focusSubscription.unsubscribe(),this.userSubscription.unsubscribe()},e.prototype.ngAfterViewInit=function(){this._setUpHistory()},e.prototype.loginTwitter=function(){this._authService.login(interfaces_1.AuthType.TWITTER)},e.prototype.loginGithub=function(){this._authService.login(interfaces_1.AuthType.GITHUB)},e.prototype._createGraphData=function(e){for(var t=this,r=[],a=[],i=[],s=new Date,o=s.getFullYear(),n=s.getMonth(),c=s.getDate(),h=0;14>h;h++){var u=new Date(o,n,c-h);r.push(u.getUTCDate()+"-"+(u.getUTCMonth()+1)+"-"+u.getUTCFullYear()),i.push(u),a.push(0)}return i.forEach(function(r,i){e.forEach(function(e,s){t._isSameDay(r,new Date(e.dateCreated))&&(a[i]=a[i]+1)})}),r.reverse(),a.reverse(),{labels:r,datasets:[{label:"Focus",fillColor:"rgba(220,220,220,0.2)",strokeColor:"#d76450",pointColor:"#d76450",pointStrokeColor:"#fff",pointHighlightFill:"#d76450",pointHighlightStroke:"rgba(220,220,220,1)",data:a}]}},e.prototype._isSameDay=function(e,t){return e.getDay()===t.getDay()&&e.getMonth()===t.getMonth()&&e.getYear()===t.getYear()},e.prototype._setUpHistory=function(){if(this.phases&&this.canvas&&this.graphCreated===!1){var e=this._createGraphData(this.phases),t=this.canvas.nativeElement.getContext("2d"),r={responsive:!0};this.chart=new Chart(t).Line(e,r),this.graphCreated=!0}},__decorate([core_1.ViewChild("canvas"),__metadata("design:type",Object)],e.prototype,"canvas",void 0),e=__decorate([core_1.Component({selector:"focus-stats",templateUrl:"app/stats.html",directives:[focus_phase_component_1.FocusPhaseCmp]}),__metadata("design:paramtypes",[auth_service_1.AuthService,data_service_1.DataService])],e)}();exports.Stats=Stats;